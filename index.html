<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLEAD Pro - Song Selection</title>
    <style>
        :root { --accent: #00d4ff; --perfect: #ffcf00; --great: #00ff8c; --good: #00d4ff; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; color: #fff; user-select: none; touch-action: none; }
        
        #game-container { 
            position: relative; width: 100%; max-width: 450px; height: 100vh; margin: 0 auto; overflow: hidden;
            border-left: 2px solid #333; border-right: 2px solid #333;
            background-size: cover; background-position: center; transition: background 0.5s;
        }

        /* 關卡選擇畫面 */
        #song-selection {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 30000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .song-card {
            width: 80%; padding: 20px; margin: 10px; background: rgba(255,255,255,0.1);
            border-left: 5px solid var(--accent); cursor: pointer; border-radius: 5px;
            transition: transform 0.2s;
        }
        .song-card:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }

        #tutorial-overlay, #start-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); z-index: 20000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        #judge-line { position: absolute; width: 100%; height: 8px; background: var(--accent); top: 85%; z-index: 100; box-shadow: 0 0 20px var(--accent); }
        .note { position: absolute; width: 25%; background: #fff; border: 2px solid #000; box-sizing: border-box; z-index: 10; border-radius: 4px; }
        .note.hold { background: rgba(0, 143, 179, 0.9); border: 2px solid #fff; box-shadow: inset 0 0 10px #00d4ff; }
        .note.active-hold { background: var(--accent) !important; box-shadow: 0 0 30px var(--accent); }
        .note.missed { background: #222 !important; border-color: #444 !important; opacity: 0.3; }

        #ui { position: absolute; top: 10%; width: 100%; text-align: center; z-index: 1000; pointer-events: none; }
        #combo-display { font-size: 64px; font-weight: 900; margin: 10px 0; }
        #score-display { font-size: 24px; font-family: monospace; letter-spacing: 2px; }
        #rating-display { font-size: 32px; font-weight: 900; font-style: italic; height: 40px; }

        #result-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 35000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        #touch-controls { position: absolute; inset: 0; z-index: 2000; display: flex; }
        .touch-zone { flex: 1; }
        button { padding: 15px 40px; font-size: 18px; border-radius: 50px; border: none; background: var(--accent); color: #000; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="song-selection">
        <h2 style="color:var(--accent)">SELECT SONG</h2>
        <div id="song-list" style="width: 100%; display: flex; flex-direction: column; align-items: center;"></div>
    </div>

    <div id="tutorial-overlay">
        <h2 style="color:var(--accent)">HOW TO PLAY</h2>
        <p>點擊四軌道 D F J K</p>
        <p>長按音符請按住直到結尾</p>
        <button id="close-tutorial">我知道了</button>
    </div>

    <div id="start-overlay">
        <h1 id="ready-song-name" style="color:var(--accent)"></h1>
        <button id="start-btn">START</button>
    </div>

    <div id="ui">
        <div id="score-display">0000000</div>
        <div id="combo-display">0</div>
        <div id="rating-display"></div>
    </div>
    <div id="judge-line"></div>
    <div id="notes-layer"></div>
    
    <div id="touch-controls">
        <div class="touch-zone" onpointerdown="handleInput(0,true)" onpointerup="handleInput(0,false)"></div>
        <div class="touch-zone" onpointerdown="handleInput(1,true)" onpointerup="handleInput(1,false)"></div>
        <div class="touch-zone" onpointerdown="handleInput(2,true)" onpointerup="handleInput(2,false)"></div>
        <div class="touch-zone" onpointerdown="handleInput(3,true)" onpointerup="handleInput(3,false)"></div>
    </div>

    <div id="result-screen">
        <h1 style="color:var(--accent)">FINISH</h1>
        <div id="final-score" style="font-size: 50px; color: var(--perfect); margin: 20px 0;">0</div>
        <button onclick="location.reload()">BACK TO MENU</button>
    </div>
</div>

<script>
    const songs = [
        {
            name: "plead",
            audio: "music1.mp3",
            bg: "bg.jpg",
            sheet: [{"t":625,"l":2,"d":125},{"t":625,"l":1,"d":125},{"t":1375,"l":2,"d":125},{"t":1375,"l":1,"d":125},{"t":2000,"l":1,"d":125},{"t":2000,"l":2,"d":125},{"t":3000,"l":1,"d":125},{"t":3000,"l":2,"d":125},{"t":3500,"l":3,"d":125},{"t":3500,"l":0,"d":125},{"t":4000,"l":1,"d":750},{"t":4000,"l":2,"d":750},{"t":5125,"l":0,"d":125},{"t":5125,"l":3,"d":125},{"t":5625,"l":1,"d":125},{"t":5625,"l":2,"d":125},{"t":6000,"l":2,"d":750},{"t":6000,"l":1,"d":750},{"t":7125,"l":3,"d":125},{"t":7125,"l":0,"d":125},{"t":8000,"l":1,"d":750},{"t":8000,"l":2,"d":750},{"t":9000,"l":3,"d":125},{"t":9000,"l":0,"d":125},{"t":9875,"l":2,"d":625},{"t":9875,"l":1,"d":625},{"t":11000,"l":3,"d":125},{"t":11000,"l":0,"d":125},{"t":12000,"l":1,"d":1125},{"t":12000,"l":2,"d":1125},{"t":13250,"l":0,"d":125},{"t":13250,"l":3,"d":125},{"t":13750,"l":3,"d":125},{"t":13750,"l":0,"d":125},{"t":14000,"l":1,"d":875},{"t":14000,"l":2,"d":875},{"t":15125,"l":3,"d":125},{"t":15125,"l":0,"d":125},{"t":16125,"l":2,"d":125},{"t":16125,"l":1,"d":125},{"t":17000,"l":0,"d":125},{"t":17000,"l":3,"d":125},{"t":17500,"l":2,"d":375},{"t":17500,"l":1,"d":375},{"t":18000,"l":0,"d":125},{"t":18000,"l":3,"d":125},{"t":18875,"l":0,"d":875},{"t":18875,"l":3,"d":875},{"t":20125,"l":1,"d":125},{"t":20125,"l":2,"d":125},{"t":20500,"l":0,"d":125},{"t":20500,"l":3,"d":125},{"t":21000,"l":1,"d":125},{"t":21000,"l":2,"d":125},{"t":21375,"l":3,"d":125},{"t":21375,"l":0,"d":125},{"t":22375,"l":3,"d":125},{"t":22375,"l":0,"d":125},{"t":23000,"l":1,"d":625},{"t":23000,"l":2,"d":625},{"t":24000,"l":0,"d":3875},{"t":24000,"l":3,"d":4000},{"t":24875,"l":2,"d":125},{"t":24875,"l":1,"d":125},{"t":26000,"l":1,"d":125},{"t":26000,"l":2,"d":125},{"t":27125,"l":1,"d":125},{"t":27125,"l":2,"d":125},{"t":27750,"l":0,"d":125},{"t":27875,"l":0,"d":125},{"t":28000,"l":2,"d":3750},{"t":28000,"l":1,"d":3750},{"t":28875,"l":0,"d":125},{"t":28875,"l":3,"d":125},{"t":29625,"l":3,"d":125},{"t":29625,"l":0,"d":125},{"t":30000,"l":0,"d":125},{"t":30000,"l":3,"d":125},{"t":30875,"l":0,"d":125},{"t":30875,"l":3,"d":125},{"t":32000,"l":0,"d":125},{"t":32000,"l":3,"d":125},{"t":32250,"l":1,"d":375},{"t":32250,"l":2,"d":375},{"t":32625,"l":0,"d":500},{"t":32625,"l":3,"d":500},{"t":33125,"l":1,"d":375},{"t":33125,"l":2,"d":375},{"t":33500,"l":0,"d":250},{"t":33500,"l":3,"d":250},{"t":34125,"l":3,"d":125},{"t":34125,"l":0,"d":125},{"t":34250,"l":2,"d":125},{"t":34250,"l":1,"d":125},{"t":34750,"l":1,"d":125},{"t":34750,"l":2,"d":125},{"t":34750,"l":0,"d":125},{"t":34750,"l":3,"d":125},{"t":35125,"l":3,"d":125},{"t":35125,"l":0,"d":125},{"t":35250,"l":3,"d":125},{"t":35250,"l":0,"d":125},{"t":35500,"l":0,"d":125},{"t":35500,"l":3,"d":125},{"t":35875,"l":1,"d":2000},{"t":35875,"l":2,"d":2000},{"t":38000,"l":0,"d":750},{"t":38000,"l":3,"d":875},{"t":39000,"l":1,"d":875},{"t":39000,"l":2,"d":875},{"t":40000,"l":0,"d":750},{"t":40000,"l":3,"d":750},{"t":40875,"l":1,"d":1000},{"t":40875,"l":2,"d":1000},{"t":41875,"l":0,"d":1000},{"t":41875,"l":3,"d":1000},{"t":42875,"l":1,"d":875},{"t":42875,"l":2,"d":875},{"t":44000,"l":2,"d":1250},{"t":44000,"l":1,"d":1250},{"t":45500,"l":0,"d":125},{"t":45500,"l":3,"d":125},{"t":45750,"l":1,"d":125},{"t":45750,"l":2,"d":125},{"t":46000,"l":3,"d":500},{"t":46000,"l":0,"d":625},{"t":46875,"l":1,"d":125},{"t":46875,"l":2,"d":125},{"t":46875,"l":0,"d":125},{"t":46875,"l":3,"d":125},{"t":47375,"l":3,"d":125},{"t":47375,"l":0,"d":125},{"t":47500,"l":1,"d":125},{"t":47500,"l":2,"d":125},{"t":47875,"l":1,"d":125},{"t":47875,"l":2,"d":125},{"t":48000,"l":3,"d":125},{"t":48000,"l":0,"d":125},{"t":48625,"l":0,"d":125},{"t":48625,"l":3,"d":125},{"t":48750,"l":0,"d":125},{"t":48750,"l":3,"d":125},{"t":48875,"l":0,"d":125},{"t":48875,"l":3,"d":125},{"t":49125,"l":0,"d":125},{"t":49125,"l":3,"d":125},{"t":49375,"l":1,"d":125},{"t":49375,"l":2,"d":125},{"t":49625,"l":0,"d":125},{"t":49625,"l":3,"d":125},{"t":50000,"l":2,"d":625},{"t":50000,"l":1,"d":625},{"t":50625,"l":0,"d":1750},{"t":50625,"l":3,"d":1750},{"t":51375,"l":2,"d":125},{"t":51375,"l":1,"d":125},{"t":51625,"l":1,"d":125},{"t":51625,"l":2,"d":125},{"t":51750,"l":1,"d":125},{"t":51750,"l":2,"d":125},{"t":52000,"l":1,"d":125},{"t":52000,"l":2,"d":125},{"t":52500,"l":1,"d":500},{"t":52500,"l":2,"d":500},{"t":52875,"l":0,"d":625},{"t":53000,"l":3,"d":500},{"t":53750,"l":2,"d":125},{"t":53750,"l":1,"d":125},{"t":54000,"l":3,"d":125},{"t":54250,"l":2,"d":125},{"t":54500,"l":1,"d":125},{"t":54625,"l":0,"d":125},{"t":54875,"l":2,"d":125},{"t":54875,"l":3,"d":125},{"t":55000,"l":0,"d":125},{"t":55375,"l":3,"d":125},{"t":55375,"l":0,"d":125},{"t":56000,"l":1,"d":125},{"t":56125,"l":2,"d":125},{"t":56250,"l":3,"d":125},{"t":56375,"l":0,"d":125},{"t":56625,"l":0,"d":125},{"t":56625,"l":3,"d":125},{"t":56750,"l":1,"d":125},{"t":56750,"l":2,"d":250},{"t":57000,"l":0,"d":125},{"t":57000,"l":3,"d":125},{"t":57125,"l":1,"d":125},{"t":57125,"l":2,"d":125},{"t":57250,"l":3,"d":125},{"t":57250,"l":0,"d":125},{"t":57500,"l":1,"d":125},{"t":57500,"l":2,"d":125},{"t":57750,"l":1,"d":125},{"t":57750,"l":2,"d":125},{"t":58000,"l":0,"d":125},{"t":58000,"l":3,"d":125},{"t":58250,"l":1,"d":125},{"t":58250,"l":2,"d":125},{"t":58375,"l":1,"d":125},{"t":58375,"l":2,"d":125},{"t":58625,"l":1,"d":125},{"t":58625,"l":2,"d":125},{"t":58875,"l":0,"d":125},{"t":58875,"l":3,"d":125},{"t":59375,"l":3,"d":125},{"t":59625,"l":3,"d":125},{"t":60000,"l":3,"d":125},{"t":60500,"l":2,"d":125},{"t":61000,"l":1,"d":125},{"t":61500,"l":0,"d":125},{"t":62125,"l":0,"d":125},{"t":62125,"l":3,"d":125},{"t":62250,"l":3,"d":125},{"t":62375,"l":0,"d":125},{"t":62625,"l":1,"d":125},{"t":62625,"l":2,"d":125},{"t":62750,"l":2,"d":125},{"t":62750,"l":1,"d":125},{"t":64000,"l":1,"d":125},{"t":64000,"l":2,"d":125},{"t":64250,"l":3,"d":125},{"t":64250,"l":0,"d":125},{"t":64500,"l":1,"d":125},{"t":64500,"l":2,"d":125},{"t":64625,"l":0,"d":125},{"t":64625,"l":3,"d":125},{"t":65000,"l":0,"d":125},{"t":65000,"l":3,"d":125},{"t":65125,"l":2,"d":125},{"t":65125,"l":1,"d":125},{"t":65250,"l":3,"d":125},{"t":65250,"l":0,"d":125},{"t":65375,"l":2,"d":125},{"t":65375,"l":1,"d":125},{"t":65375,"l":0,"d":125},{"t":65375,"l":3,"d":125},{"t":65625,"l":0,"d":125},{"t":65625,"l":3,"d":125},{"t":65625,"l":1,"d":125},{"t":65625,"l":2,"d":125},{"t":66000,"l":1,"d":125},{"t":66000,"l":2,"d":125},{"t":66250,"l":1,"d":125},{"t":66250,"l":2,"d":125},{"t":66500,"l":3,"d":125},{"t":66500,"l":0,"d":125},{"t":66625,"l":0,"d":125},{"t":66625,"l":3,"d":125},{"t":66875,"l":0,"d":125},{"t":66875,"l":3,"d":125},{"t":67375,"l":1,"d":125},{"t":67375,"l":2,"d":125},{"t":67750,"l":3,"d":125},{"t":67750,"l":0,"d":125},{"t":68000,"l":3,"d":125},{"t":68500,"l":2,"d":125},{"t":69000,"l":1,"d":125},{"t":69500,"l":0,"d":125},{"t":70000,"l":3,"d":125},{"t":70125,"l":2,"d":125},{"t":70375,"l":1,"d":125},{"t":70500,"l":0,"d":250},{"t":70750,"l":3,"d":125},{"t":70875,"l":1,"d":125},{"t":70875,"l":2,"d":125},{"t":71000,"l":0,"d":125},{"t":71375,"l":2,"d":125},{"t":71375,"l":1,"d":125},{"t":71625,"l":1,"d":125},{"t":71625,"l":2,"d":125},{"t":71875,"l":1,"d":125},{"t":71875,"l":2,"d":125},{"t":72000,"l":2,"d":125},{"t":72000,"l":1,"d":125},{"t":72500,"l":0,"d":125},{"t":72500,"l":3,"d":125},{"t":73125,"l":1,"d":125},{"t":73500,"l":2,"d":125},{"t":73625,"l":1,"d":125},{"t":73750,"l":2,"d":125},{"t":73875,"l":1,"d":125},{"t":73875,"l":2,"d":125},{"t":74250,"l":3,"d":125},{"t":74375,"l":0,"d":125},{"t":74625,"l":0,"d":125},{"t":74625,"l":3,"d":125},{"t":74750,"l":0,"d":125},{"t":74875,"l":3,"d":125},{"t":75250,"l":2,"d":125},{"t":75250,"l":1,"d":250},{"t":75500,"l":0,"d":125},{"t":75500,"l":3,"d":125},{"t":76000,"l":3,"d":125},{"t":76500,"l":2,"d":125},{"t":76875,"l":1,"d":125},{"t":77375,"l":0,"d":125},{"t":78000,"l":0,"d":125},{"t":78125,"l":1,"d":125},{"t":78375,"l":2,"d":125},{"t":78500,"l":3,"d":125},{"t":78750,"l":2,"d":250},{"t":79000,"l":1,"d":125},{"t":79875,"l":0,"d":125},{"t":79875,"l":3,"d":125},{"t":80125,"l":2,"d":125},{"t":80500,"l":3,"d":125},{"t":81000,"l":1,"d":125},{"t":81250,"l":0,"d":125},{"t":81500,"l":1,"d":125},{"t":81500,"l":2,"d":125},{"t":81625,"l":0,"d":125},{"t":81625,"l":3,"d":125},{"t":82000,"l":1,"d":125},{"t":82000,"l":2,"d":125},{"t":82375,"l":1,"d":125},{"t":82500,"l":2,"d":125},{"t":82625,"l":1,"d":125},{"t":82625,"l":2,"d":125},{"t":82875,"l":1,"d":125},{"t":83000,"l":2,"d":125},{"t":83125,"l":3,"d":125},{"t":83250,"l":0,"d":125},{"t":83500,"l":1,"d":125},{"t":83500,"l":2,"d":125},{"t":83625,"l":0,"d":125},{"t":83625,"l":3,"d":125},{"t":83875,"l":2,"d":125},{"t":83875,"l":1,"d":125},{"t":83875,"l":0,"d":125},{"t":83875,"l":3,"d":125},{"t":84375,"l":1,"d":2750},{"t":84375,"l":2,"d":2750}]
        },
        {
            name: "creation of hatred",
            audio: "music2.mp3",
            bg: "bg2.jpg",
            sheet: [{"t":1000,"l":1,"d":125},{"t":1000,"l":2,"d":125},{"t":1375,"l":1,"d":125},{"t":1375,"l":2,"d":125},{"t":2000,"l":1,"d":125},{"t":2000,"l":2,"d":125},{"t":2500,"l":1,"d":125},{"t":2500,"l":2,"d":125},{"t":3000,"l":1,"d":125},{"t":3000,"l":2,"d":125},{"t":3500,"l":0,"d":125},{"t":3500,"l":3,"d":125},{"t":4000,"l":3,"d":125},{"t":4000,"l":0,"d":125},{"t":4500,"l":3,"d":125},{"t":4500,"l":0,"d":125},{"t":5000,"l":0,"d":125},{"t":5000,"l":3,"d":125},{"t":5375,"l":0,"d":500},{"t":5375,"l":3,"d":500},{"t":6000,"l":1,"d":250},{"t":6000,"l":2,"d":250},{"t":6375,"l":0,"d":125},{"t":6375,"l":3,"d":125},{"t":7000,"l":2,"d":125},{"t":7000,"l":1,"d":125},{"t":7375,"l":1,"d":125},{"t":7375,"l":2,"d":125},{"t":7875,"l":1,"d":125},{"t":7875,"l":2,"d":125},{"t":8000,"l":0,"d":125},{"t":8000,"l":3,"d":125},{"t":8500,"l":1,"d":125},{"t":8500,"l":2,"d":125},{"t":8875,"l":3,"d":125},{"t":9000,"l":2,"d":125},{"t":9375,"l":1,"d":125},{"t":9750,"l":0,"d":125},{"t":10000,"l":2,"d":125},{"t":10000,"l":1,"d":125},{"t":10375,"l":3,"d":125},{"t":10625,"l":0,"d":125},{"t":10875,"l":2,"d":125},{"t":10875,"l":1,"d":125},{"t":11000,"l":0,"d":125},{"t":11000,"l":3,"d":125},{"t":11375,"l":3,"d":250},{"t":11500,"l":2,"d":250},{"t":11750,"l":1,"d":250},{"t":12000,"l":0,"d":125},{"t":12000,"l":3,"d":125},{"t":12500,"l":2,"d":125},{"t":12750,"l":1,"d":125},{"t":12875,"l":0,"d":125},{"t":12875,"l":3,"d":125},{"t":13000,"l":1,"d":125},{"t":13000,"l":2,"d":125},{"t":13375,"l":3,"d":125},{"t":13500,"l":0,"d":125},{"t":13750,"l":2,"d":125},{"t":13750,"l":1,"d":125},{"t":14000,"l":0,"d":125},{"t":14000,"l":3,"d":125},{"t":14125,"l":2,"d":125},{"t":14125,"l":1,"d":125},{"t":14500,"l":0,"d":125},{"t":14500,"l":3,"d":125},{"t":14750,"l":1,"d":125},{"t":14750,"l":2,"d":125},{"t":14875,"l":3,"d":125},{"t":15000,"l":0,"d":125},{"t":15125,"l":2,"d":125},{"t":15125,"l":1,"d":125},{"t":15500,"l":3,"d":125},{"t":15500,"l":0,"d":125},{"t":15875,"l":1,"d":125},{"t":15875,"l":2,"d":125},{"t":16125,"l":2,"d":125},{"t":16125,"l":1,"d":125},{"t":16500,"l":2,"d":125},{"t":16750,"l":3,"d":125},{"t":16875,"l":0,"d":125},{"t":16875,"l":1,"d":125},{"t":17125,"l":0,"d":125},{"t":17125,"l":2,"d":125},{"t":17125,"l":3,"d":125},{"t":17500,"l":1,"d":125},{"t":17500,"l":2,"d":125},{"t":17750,"l":0,"d":125},{"t":17875,"l":3,"d":125},{"t":18000,"l":2,"d":125},{"t":18000,"l":1,"d":125},{"t":18000,"l":3,"d":125},{"t":18375,"l":3,"d":125},{"t":18500,"l":0,"d":125},{"t":18750,"l":1,"d":125},{"t":18750,"l":2,"d":125},{"t":19000,"l":1,"d":1875},{"t":19000,"l":2,"d":2000},{"t":19375,"l":0,"d":125},{"t":19375,"l":3,"d":125},{"t":19750,"l":0,"d":125},{"t":19750,"l":3,"d":125},{"t":19875,"l":3,"d":125},{"t":20500,"l":3,"d":250},{"t":20750,"l":0,"d":250},{"t":21000,"l":3,"d":125},{"t":21000,"l":0,"d":125},{"t":21375,"l":0,"d":125},{"t":21375,"l":3,"d":125},{"t":21750,"l":2,"d":125},{"t":21875,"l":1,"d":125},{"t":22000,"l":0,"d":125},{"t":22000,"l":3,"d":125},{"t":22375,"l":1,"d":125},{"t":22375,"l":2,"d":250},{"t":22750,"l":0,"d":125},{"t":22750,"l":3,"d":125},{"t":22875,"l":1,"d":125},{"t":22875,"l":2,"d":125},{"t":23000,"l":0,"d":125},{"t":23000,"l":3,"d":125},{"t":23375,"l":2,"d":125},{"t":23375,"l":1,"d":125},{"t":23625,"l":2,"d":125},{"t":23625,"l":1,"d":125},{"t":24000,"l":2,"d":125},{"t":24125,"l":1,"d":125},{"t":24125,"l":3,"d":3500},{"t":24125,"l":0,"d":3500},{"t":24500,"l":1,"d":125},{"t":24500,"l":2,"d":125},{"t":24875,"l":2,"d":125},{"t":24875,"l":1,"d":125},{"t":25000,"l":1,"d":125},{"t":25000,"l":2,"d":125},{"t":25375,"l":1,"d":125},{"t":25375,"l":2,"d":125},{"t":25625,"l":2,"d":125},{"t":25625,"l":1,"d":125},{"t":25750,"l":2,"d":125},{"t":25750,"l":1,"d":125},{"t":25875,"l":2,"d":125},{"t":25875,"l":1,"d":125},{"t":26250,"l":2,"d":125},{"t":26250,"l":1,"d":125},{"t":26375,"l":1,"d":125},{"t":26375,"l":2,"d":125},{"t":26875,"l":1,"d":125},{"t":26875,"l":2,"d":125},{"t":27375,"l":1,"d":125},{"t":27375,"l":2,"d":125},{"t":27500,"l":2,"d":125},{"t":28000,"l":2,"d":3625},{"t":28000,"l":1,"d":3625},{"t":28125,"l":0,"d":125},{"t":28250,"l":3,"d":125},{"t":28500,"l":0,"d":125},{"t":28500,"l":3,"d":125},{"t":28625,"l":0,"d":125},{"t":28625,"l":3,"d":125},{"t":28750,"l":0,"d":125},{"t":28750,"l":3,"d":125},{"t":29000,"l":3,"d":125},{"t":29000,"l":0,"d":125},{"t":29375,"l":0,"d":125},{"t":29375,"l":3,"d":125},{"t":29625,"l":0,"d":125},{"t":29625,"l":3,"d":125},{"t":29750,"l":3,"d":125},{"t":29875,"l":0,"d":125},{"t":30000,"l":0,"d":125},{"t":30000,"l":3,"d":125},{"t":30375,"l":3,"d":125},{"t":30375,"l":0,"d":125},{"t":30500,"l":0,"d":125},{"t":30500,"l":3,"d":125},{"t":30875,"l":0,"d":125},{"t":31000,"l":3,"d":125},{"t":31250,"l":0,"d":125},{"t":31250,"l":3,"d":125},{"t":31500,"l":3,"d":125},{"t":31500,"l":0,"d":125},{"t":31875,"l":3,"d":375},{"t":31875,"l":0,"d":375},{"t":32000,"l":1,"d":500},{"t":32000,"l":2,"d":625},{"t":32500,"l":0,"d":250},{"t":32500,"l":3,"d":375},{"t":32875,"l":1,"d":125},{"t":32875,"l":2,"d":125},{"t":32875,"l":0,"d":125},{"t":32875,"l":3,"d":250},{"t":33000,"l":1,"d":125},{"t":33125,"l":2,"d":125},{"t":33375,"l":1,"d":125},{"t":33375,"l":0,"d":125},{"t":33500,"l":3,"d":125},{"t":33500,"l":2,"d":125},{"t":33875,"l":1,"d":125},{"t":33875,"l":2,"d":125},{"t":33875,"l":3,"d":125},{"t":33875,"l":0,"d":125},{"t":34125,"l":1,"d":250},{"t":34125,"l":2,"d":375},{"t":34375,"l":0,"d":2625},{"t":34375,"l":3,"d":2625},{"t":34750,"l":1,"d":125},{"t":34750,"l":2,"d":125},{"t":35000,"l":1,"d":125},{"t":35000,"l":2,"d":125},{"t":35500,"l":1,"d":125},{"t":35500,"l":2,"d":125},{"t":35875,"l":1,"d":125},{"t":35875,"l":2,"d":125},{"t":36000,"l":1,"d":125},{"t":36000,"l":2,"d":125},{"t":36500,"l":2,"d":125},{"t":36500,"l":1,"d":125},{"t":36875,"l":2,"d":125},{"t":36875,"l":1,"d":125},{"t":37000,"l":2,"d":2875},{"t":37125,"l":0,"d":250},{"t":37125,"l":1,"d":2750},{"t":37375,"l":3,"d":125},{"t":37750,"l":3,"d":125},{"t":37875,"l":0,"d":125},{"t":38000,"l":0,"d":125},{"t":38000,"l":3,"d":125},{"t":38375,"l":0,"d":125},{"t":38375,"l":3,"d":125},{"t":38750,"l":0,"d":125},{"t":38875,"l":3,"d":125},{"t":39000,"l":0,"d":125},{"t":39000,"l":3,"d":125},{"t":39375,"l":0,"d":125},{"t":39375,"l":3,"d":125},{"t":39625,"l":0,"d":250},{"t":39625,"l":3,"d":250},{"t":40000,"l":2,"d":125},{"t":40000,"l":3,"d":125},{"t":40125,"l":1,"d":125},{"t":40125,"l":0,"d":125},{"t":40500,"l":1,"d":125},{"t":40500,"l":0,"d":125},{"t":40500,"l":2,"d":125},{"t":40500,"l":3,"d":125},{"t":40875,"l":1,"d":125},{"t":40875,"l":0,"d":125},{"t":40875,"l":2,"d":125},{"t":40875,"l":3,"d":125},{"t":41125,"l":1,"d":125},{"t":41125,"l":0,"d":125},{"t":41125,"l":2,"d":125},{"t":41125,"l":3,"d":125},{"t":41500,"l":1,"d":125},{"t":41500,"l":2,"d":125},{"t":41500,"l":3,"d":125},{"t":41500,"l":0,"d":125},{"t":41875,"l":2,"d":125},{"t":41875,"l":1,"d":125},{"t":41875,"l":0,"d":125},{"t":41875,"l":3,"d":125},{"t":42000,"l":1,"d":125},{"t":42000,"l":0,"d":125},{"t":42000,"l":2,"d":125},{"t":42000,"l":3,"d":125},{"t":42500,"l":3,"d":125},{"t":42500,"l":2,"d":125},{"t":42500,"l":0,"d":125},{"t":42500,"l":1,"d":125},{"t":42875,"l":2,"d":125},{"t":42875,"l":3,"d":125},{"t":42875,"l":1,"d":125},{"t":42875,"l":0,"d":125},{"t":43125,"l":0,"d":125},{"t":43125,"l":2,"d":125},{"t":43125,"l":3,"d":125},{"t":43125,"l":1,"d":125},{"t":43500,"l":3,"d":125},{"t":43500,"l":0,"d":125},{"t":43500,"l":1,"d":125},{"t":43500,"l":2,"d":125},{"t":43750,"l":1,"d":125},{"t":43875,"l":3,"d":125},{"t":43875,"l":2,"d":125},{"t":44125,"l":2,"d":125},{"t":44500,"l":2,"d":125},{"t":44875,"l":0,"d":125},{"t":45125,"l":3,"d":125},{"t":45375,"l":1,"d":125},{"t":45875,"l":2,"d":125},{"t":46000,"l":0,"d":125},{"t":46500,"l":3,"d":250},{"t":46875,"l":1,"d":125},{"t":47000,"l":2,"d":125},{"t":47500,"l":0,"d":125},{"t":47875,"l":1,"d":125},{"t":48125,"l":3,"d":125},{"t":48500,"l":2,"d":125},{"t":48875,"l":1,"d":125},{"t":49125,"l":2,"d":125},{"t":49500,"l":0,"d":250},{"t":49750,"l":2,"d":250},{"t":50000,"l":0,"d":2125},{"t":50250,"l":2,"d":125},{"t":50500,"l":2,"d":125},{"t":50875,"l":3,"d":125},{"t":51125,"l":3,"d":125},{"t":51500,"l":2,"d":125},{"t":51875,"l":3,"d":125},{"t":52000,"l":3,"d":1625},{"t":52500,"l":1,"d":125},{"t":52875,"l":1,"d":125},{"t":53125,"l":1,"d":125},{"t":53375,"l":0,"d":1000},{"t":53750,"l":2,"d":125},{"t":54000,"l":3,"d":125},{"t":54375,"l":2,"d":250},{"t":54750,"l":1,"d":125},{"t":55000,"l":3,"d":125},{"t":55000,"l":0,"d":125},{"t":55500,"l":3,"d":125},{"t":55500,"l":0,"d":125},{"t":55875,"l":3,"d":125},{"t":55875,"l":0,"d":125},{"t":56125,"l":3,"d":375},{"t":56500,"l":0,"d":250},{"t":56875,"l":0,"d":125},{"t":57000,"l":2,"d":2875},{"t":57500,"l":1,"d":125},{"t":58000,"l":0,"d":125},{"t":58500,"l":1,"d":125},{"t":59000,"l":0,"d":125},{"t":59250,"l":0,"d":125},{"t":59500,"l":1,"d":125},{"t":59750,"l":0,"d":125},{"t":60000,"l":1,"d":3750},{"t":60125,"l":2,"d":125},{"t":60500,"l":2,"d":125},{"t":61000,"l":3,"d":125},{"t":61250,"l":3,"d":125},{"t":61375,"l":3,"d":125},{"t":61625,"l":2,"d":125},{"t":61875,"l":3,"d":125},{"t":62125,"l":3,"d":125},{"t":62625,"l":2,"d":125},{"t":63125,"l":3,"d":125},{"t":63250,"l":3,"d":125},{"t":63500,"l":2,"d":125},{"t":63625,"l":3,"d":125},{"t":63875,"l":0,"d":250},{"t":64000,"l":3,"d":125},{"t":64375,"l":2,"d":125},{"t":64500,"l":1,"d":250},{"t":64875,"l":2,"d":125},{"t":65000,"l":1,"d":125},{"t":65250,"l":2,"d":125},{"t":65375,"l":1,"d":125},{"t":65500,"l":2,"d":125},{"t":65750,"l":1,"d":125},{"t":66000,"l":0,"d":125},{"t":66125,"l":3,"d":125},{"t":66500,"l":3,"d":125},{"t":66625,"l":0,"d":125},{"t":67000,"l":2,"d":125},{"t":67125,"l":1,"d":125},{"t":67375,"l":2,"d":125},{"t":67500,"l":1,"d":125},{"t":67750,"l":2,"d":125},{"t":68000,"l":3,"d":125},{"t":68125,"l":0,"d":125},{"t":68500,"l":3,"d":125},{"t":68500,"l":0,"d":125},{"t":68875,"l":2,"d":125},{"t":69000,"l":1,"d":125},{"t":69250,"l":2,"d":125},{"t":69375,"l":1,"d":125},{"t":69500,"l":2,"d":125},{"t":69625,"l":1,"d":125},{"t":70000,"l":3,"d":125},{"t":70500,"l":2,"d":125},{"t":70500,"l":1,"d":125},{"t":71125,"l":2,"d":125},{"t":71250,"l":1,"d":125},{"t":71375,"l":2,"d":125},{"t":71625,"l":2,"d":125},{"t":71625,"l":1,"d":125},{"t":72000,"l":3,"d":125},{"t":72375,"l":3,"d":250},{"t":72750,"l":0,"d":125},{"t":72875,"l":3,"d":125},{"t":73000,"l":0,"d":125},{"t":73375,"l":0,"d":125},{"t":73750,"l":3,"d":125},{"t":73875,"l":0,"d":125},{"t":74125,"l":3,"d":125},{"t":74500,"l":3,"d":125},{"t":74875,"l":0,"d":125},{"t":75000,"l":3,"d":125},{"t":75125,"l":0,"d":125},{"t":75500,"l":3,"d":125},{"t":75875,"l":3,"d":125},{"t":76000,"l":3,"d":125},{"t":76500,"l":0,"d":125},{"t":76875,"l":3,"d":125},{"t":77125,"l":2,"d":125},{"t":77500,"l":2,"d":125},{"t":77750,"l":2,"d":125},{"t":78000,"l":1,"d":125},{"t":78125,"l":3,"d":125},{"t":78500,"l":0,"d":125},{"t":78750,"l":2,"d":125},{"t":79000,"l":1,"d":125},{"t":79125,"l":3,"d":125},{"t":79500,"l":3,"d":125},{"t":79750,"l":3,"d":125},{"t":80000,"l":1,"d":125},{"t":80375,"l":2,"d":125},{"t":80750,"l":1,"d":125},{"t":80875,"l":3,"d":125},{"t":81125,"l":1,"d":125},{"t":81500,"l":3,"d":125},{"t":81875,"l":3,"d":125},{"t":82000,"l":1,"d":125},{"t":82375,"l":2,"d":125},{"t":82750,"l":0,"d":125},{"t":83125,"l":3,"d":125},{"t":83500,"l":3,"d":125},{"t":83750,"l":3,"d":125},{"t":84000,"l":1,"d":125},{"t":84375,"l":2,"d":125},{"t":84750,"l":0,"d":125},{"t":85000,"l":3,"d":125},{"t":85250,"l":3,"d":125},{"t":85750,"l":3,"d":125},{"t":85875,"l":1,"d":125},{"t":86125,"l":2,"d":125},{"t":86375,"l":3,"d":125},{"t":86375,"l":0,"d":125},{"t":86875,"l":2,"d":125},{"t":86875,"l":1,"d":125},{"t":87125,"l":0,"d":125},{"t":87125,"l":3,"d":125},{"t":87500,"l":0,"d":125},{"t":87500,"l":3,"d":125},{"t":88000,"l":2,"d":125},{"t":88000,"l":1,"d":125},{"t":89000,"l":1,"d":1625},{"t":89000,"l":2,"d":1625}] 
        }
    ];

    let currentSong = null, music = new Audio(), gameActive = false, score = 0, combo = 0, spawnIndex = 0, notes = [];
    let activeKeys = {0:false, 1:false, 2:false, 3:false};
    const keyMap = { 'd':0, 'f':1, 'j':2, 'k':3, 'D':0, 'F':1, 'J':2, 'K':3 };

    // 初始化選單
    const songListEl = document.getElementById('song-list');
    songs.forEach((song, index) => {
        const card = document.createElement('div');
        card.className = 'song-card';
        card.innerHTML = `<strong>${song.name}</strong>`;
        card.onclick = () => selectSong(index);
        songListEl.appendChild(card);
    });

    function selectSong(index) {
        currentSong = songs[index];
        music.src = currentSong.audio;
        document.getElementById('game-container').style.backgroundImage = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('${currentSong.bg}')`;
        document.getElementById('song-selection').style.display = 'none';
        document.getElementById('tutorial-overlay').style.display = 'flex';
    }

    document.getElementById('close-tutorial').onclick = () => {
        document.getElementById('tutorial-overlay').style.display = 'none';
        document.getElementById('start-overlay').style.display = 'flex';
        document.getElementById('ready-song-name').innerText = currentSong.name;
    };

    document.getElementById('start-btn').onclick = () => {
        document.getElementById('start-overlay').style.display = 'none';
        music.play().then(() => { gameActive = true; requestAnimationFrame(gameLoop); });
    };

    function handleInput(lane, isDown) { activeKeys[lane] = isDown; }
    window.addEventListener('keydown', (e) => { if(keyMap[e.key]!==undefined && !e.repeat) handleInput(keyMap[e.key], true); });
    window.addEventListener('keyup', (e) => { if(keyMap[e.key]!==undefined) handleInput(keyMap[e.key], false); });

    function addScore(type) {
        let p = (type === 'perfect') ? 100 : (type === 'great' ? 50 : (type === 'good' ? 10 : 0));
        if(type !== 'miss') { score += p; combo++; } else { combo = 0; }
        const rd = document.getElementById('rating-display');
        rd.innerText = type.toUpperCase(); rd.className = 'rating-' + type;
        document.getElementById('combo-display').innerText = combo;
        document.getElementById('score-display').innerText = score.toString().padStart(7, '0');
    }

    function gameLoop() {
        if(!gameActive) return;
        const now = music.currentTime * 1000;
        const judgeY = window.innerHeight * 0.85;
        const speed = 0.8;

        while(spawnIndex < currentSong.sheet.length && now > currentSong.sheet[spawnIndex].t - 1500) {
            const d = currentSong.sheet[spawnIndex];
            const el = document.createElement('div');
            el.className = 'note' + (d.d > 200 ? ' hold' : '');
            el.style.left = (d.l * 25) + '%';
            document.getElementById('notes-layer').appendChild(el);
            notes.push({...d, el, hit: false, missed: false, lastTick: 0});
            spawnIndex++;
        }

        for(let i = notes.length-1; i >= 0; i--) {
            const n = notes[i];
            const tailTime = n.t + n.d;
            let hY = (n.d > 200 && now >= n.t && activeKeys[n.l] && !n.missed) ? judgeY : judgeY - (n.t - now) * speed;
            let tY = judgeY - (tailTime - now) * speed;
            let h = (n.d <= 200) ? 45 : Math.abs(hY - tY);
            n.el.style.top = tY + 'px'; n.el.style.height = h + 'px';

            if (n.d > 200) {
                if (now >= n.t && now <= tailTime) {
                    if (activeKeys[n.l] && !n.missed) {
                        n.el.classList.add('active-hold');
                        if(Math.floor(now/100) !== n.lastTick) { score += 10; n.lastTick = Math.floor(now/100); }
                    } else if (!n.missed && now > n.t + 150) {
                        n.missed = true; addScore('miss'); n.el.classList.add('missed');
                    }
                }
                if (now > tailTime) { if(!n.missed) addScore('perfect'); n.el.remove(); notes.splice(i, 1); }
            } else {
                if (!n.hit && activeKeys[n.l]) {
                    const diff = Math.abs(n.t - now);
                    if (diff < 150) { n.hit = true; n.el.style.display='none'; addScore(diff < 50 ? 'perfect' : (diff < 100 ? 'great' : 'good')); }
                }
                if (now > n.t + 150) { if(!n.hit) addScore('miss'); n.el.remove(); notes.splice(i, 1); }
            }
        }

        if(music.ended || (spawnIndex >= currentSong.sheet.length && notes.length === 0)) {
            setTimeout(() => { document.getElementById('result-screen').style.display = 'flex'; document.getElementById('final-score').innerText = score; }, 2000);
            gameActive = false;
        } else { requestAnimationFrame(gameLoop); }
    }
</script>
</body>
</html>